{"ast":null,"code":"var _jsxFileName = \"/Users/luciano/Desktop/Projetos/PlayerStars/frontend/src/views/view/view.js\";\nimport React, { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport { Redirect } from \"react-router-dom\";\nimport { Auth } from \"aws-amplify\";\nimport Menu from \"../../components/Header/Menu\";\nimport Footer from \"../../components/Footer\"; // import {FireworkSpinner} from \"react-spinners-kit\"\n\nimport config from \"../../config/constants\";\nconst API = {\n  get: (a, b, c) => new Promise(okfn => okfn({\n    entity_id: b\n  }))\n};\n\nclass View extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      loading: true,\n      redirect: false,\n      user_data: undefined\n    };\n  }\n\n  redirect_to_error(error_message) {\n    this.setState({\n      redirect: true,\n      loading: false,\n      to: {\n        pathname: \"/\",\n        state: {\n          message: error_message\n        }\n      }\n    });\n  }\n\n  redirect_to_login() {\n    this.setState({\n      redirect: true,\n      loading: false,\n      to: {\n        pathname: \"/login\"\n      }\n    });\n  }\n\n  redirect_to_cadastro() {\n    this.setState({\n      loading: false,\n      redirect: true,\n      to: {\n        pathname: \"/dadosuser\"\n      }\n    });\n  }\n\n  get_user_data(cognito_response) {\n    const user_id = cognito_response.attributes.sub;\n    API.get(config.APIS.PLAYERSTARS, \"/user/\".concat(user_id), {}).then(response => {\n      console.log('get user data bem sucedido. Response: ', response);\n      this.setState({\n        loading: false,\n        user_data: {\n          cognito_user: cognito_response,\n          data: response.data\n        }\n      });\n    }).catch(error => {\n      console.log('get user data falhou: ', error);\n\n      if (error.response && error.response.status === 404) {\n        this.redirect_to_cadastro();\n      } else {\n        this.redirect_to_error('Erro obtendo dados do usuário'); //error.response.message)\n\n        console.log('Erro obtendo dados o usuário: ', error.response);\n      }\n    });\n    console.log(this.props);\n    console.log(this.props.cadastro);\n    console.log(this.props.public);\n    console.log(this.props.user_data);\n  }\n\n  get_authenticated_user() {\n    Auth.currentAuthenticatedUser().then(response => {\n      console.log('get_authenticated_user, response:', response);\n      console.log('Is cadastro view?', this.is_cadastro_view());\n\n      if (!this.is_cadastro_view()) {\n        this.get_user_data(response);\n      }\n\n      this.setState({\n        loading: false,\n        user_data: {\n          cognito_user: response\n        }\n      });\n    }).catch(error => {\n      if (!this.is_public_view()) {\n        if (error === \"not authenticated\") {\n          this.redirect_to_login();\n        } else {\n          this.redirect_to_error(error);\n        }\n      } else {\n        this.setState({\n          loading: false\n        });\n      }\n    });\n  }\n\n  is_cadastro_view() {\n    return this.props.cadastro;\n  }\n\n  is_public_view() {\n    return this.props.public;\n  }\n\n  has_user_data() {\n    return this.props.user_data !== undefined;\n  }\n\n  componentDidMount() {\n    console.log('view: componentDidMoutt: has_user_data:', this.has_user_data());\n\n    if (!this.has_user_data()) {\n      this.get_authenticated_user();\n    }\n  } // noinspection JSMethodCanBeStatic\n\n\n  renderLoading() {\n    return React.createElement(\"div\", {\n      className: \"Loading\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 131\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      stile: \"font-size:70\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 132\n      },\n      __self: this\n    }, \"Carregando...\")));\n  }\n\n  renderContent() {\n    const children = React.Children.map(this.props.children, child => React.cloneElement(child, {\n      user_data: this.state.user_data\n    }));\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142\n      },\n      __self: this\n    }, children);\n  }\n\n  render() {\n    if (this.state.redirect) {\n      return React.createElement(Redirect, {\n        to: this.state.to,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 150\n        },\n        __self: this\n      });\n    }\n\n    const content = this.state.loading ? this.renderLoading() : this.renderContent();\n    return React.createElement(React.Fragment, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155\n      },\n      __self: this\n    }, React.createElement(Menu, {\n      user_data: this.state.user_data,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }), content, React.createElement(Footer, {\n      user_data: this.state.user_data,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158\n      },\n      __self: this\n    }));\n  }\n\n}\n\nView.propTypes = {\n  background: PropTypes.any,\n  backgroundHeight: PropTypes.string,\n  public: PropTypes.bool,\n  cadastro: PropTypes.bool\n};\nexport default View;","map":{"version":3,"sources":["/Users/luciano/Desktop/Projetos/PlayerStars/frontend/src/views/view/view.js"],"names":["React","Component","PropTypes","Redirect","Auth","Menu","Footer","config","API","get","a","b","c","Promise","okfn","entity_id","View","state","loading","redirect","user_data","undefined","redirect_to_error","error_message","setState","to","pathname","message","redirect_to_login","redirect_to_cadastro","get_user_data","cognito_response","user_id","attributes","sub","APIS","PLAYERSTARS","then","response","console","log","cognito_user","data","catch","error","status","props","cadastro","public","get_authenticated_user","currentAuthenticatedUser","is_cadastro_view","is_public_view","has_user_data","componentDidMount","renderLoading","renderContent","children","Children","map","child","cloneElement","render","content","propTypes","background","any","backgroundHeight","string","bool"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport PropTypes from 'prop-types'\nimport { Redirect } from \"react-router-dom\"\n\nimport { Auth } from \"aws-amplify\"\nimport Menu from \"../../components/Header/Menu\"\nimport Footer from \"../../components/Footer\"\n// import {FireworkSpinner} from \"react-spinners-kit\"\nimport config from \"../../config/constants\"\n\nconst API = {\n  get: (a, b, c) => new Promise((okfn) => okfn({entity_id: b}))\n}\n\nclass View extends Component {\n  state = {\n    loading: true,\n    redirect: false,\n    user_data: undefined\n  };\n\n  redirect_to_error(error_message) {\n    this.setState({\n      redirect: true,\n      loading: false,\n      to: {\n        pathname: \"/\",\n        state: {\n          message: error_message\n        }\n      }\n    })\n  }\n\n  redirect_to_login() {\n    this.setState({\n      redirect: true,\n      loading: false,\n      to: {\n        pathname: \"/login\"\n      }\n    })\n  }\n\n  redirect_to_cadastro() {\n    this.setState({\n      loading: false,\n      redirect: true,\n      to: {pathname: \"/dadosuser\"}\n    })\n  }\n\n  get_user_data(cognito_response) {\n    const user_id = cognito_response.attributes.sub\n    API.get(config.APIS.PLAYERSTARS, `/user/${user_id}`, {})\n      .then(response => {\n        console.log('get user data bem sucedido. Response: ', response)\n        this.setState({\n          loading: false,\n          user_data: {\n            cognito_user: cognito_response,\n            data: response.data\n          }\n        })\n      })\n      .catch(error => {\n        console.log('get user data falhou: ', error)\n        if (error.response && error.response.status === 404) {\n          this.redirect_to_cadastro()\n        } else {\n          this.redirect_to_error('Erro obtendo dados do usuário')//error.response.message)\n          console.log('Erro obtendo dados o usuário: ', error.response)\n        }\n      })\n      console.log(this.props)\n      console.log(this.props.cadastro)\n      console.log(this.props.public)\n      console.log(this.props.user_data)\n  }\n\n  get_authenticated_user() {\n    Auth.currentAuthenticatedUser()\n      .then(response => {\n        console.log('get_authenticated_user, response:', response)\n        console.log('Is cadastro view?', this.is_cadastro_view())\n        if(!this.is_cadastro_view()) {\n          this.get_user_data(response)\n        }\n        this.setState({\n          loading: false, \n          user_data: {\n            cognito_user: response\n          }\n        })\n      })\n      .catch(error => {\n        if(!this.is_public_view()) {\n          if (error === \"not authenticated\") {\n            this.redirect_to_login()\n          } else {\n            this.redirect_to_error(error)\n          }\n        }\n        else {\n          this.setState({loading: false})\n        }\n      })\n  }\n\n  is_cadastro_view() {\n    return this.props.cadastro\n  }\n\n  is_public_view() {\n    return this.props.public\n  }\n\n  has_user_data() {\n    return this.props.user_data !== undefined\n  }\n  componentDidMount() {\n    console.log('view: componentDidMoutt: has_user_data:', this.has_user_data())\n    if(!this.has_user_data()) {\n      this.get_authenticated_user()\n    }\n  }\n\n  // noinspection JSMethodCanBeStatic\n  renderLoading() {\n    return (\n      <div className=\"Loading\">\n        <div><p stile=\"font-size:70\">Carregando...</p></div>\n      </div>\n    )\n  }\n\n  renderContent() {\n    const children = React.Children.map(this.props.children,\n      child => React.cloneElement(child, {user_data: this.state.user_data}))\n\n    return (\n      <React.Fragment>\n        {children}\n      </React.Fragment>\n    )\n  }\n\n  render() {\n    if (this.state.redirect) {\n      return <Redirect to={this.state.to}/>\n    }\n\n    const content = (this.state.loading) ? (this.renderLoading()) : (this.renderContent())\n    return (\n      <React.Fragment>\n        <Menu user_data={this.state.user_data}/>\n        {content}\n        <Footer user_data={this.state.user_data}/>\n      </React.Fragment>\n    )\n  }\n}\n\nView.propTypes = {\n  background: PropTypes.any,\n  backgroundHeight: PropTypes.string,\n  public: PropTypes.bool,\n  cadastro: PropTypes.bool\n}\n\nexport default View\n"]},"metadata":{},"sourceType":"module"}